<!DOCTYPE html>
<html lang="en">
<head>
    <title lang="en">chou.ninja</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .block {
            width: 30%;
            border-width: medium;
            font-size: x-large;
            margin-bottom: inherit;
            background-color: aliceblue;
            font-weight: bold;
            height: 5em;
            vertical-align: middle;
        }
        #answer {
            font-size: xx-large;
        }
        body {
            text-align: center;
        }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
      $(window).on('load', function() {
        main();
      });

      function getDayOfTheMonthAudio(number) {
          var source = $("<source />")
            .attr("src", "https://px0asnk62c.execute-api.ap-northeast-1.amazonaws.com/prod/day-of-month/" + number)
            .attr("type", "audio/mpeg");
          var audio = $("<audio />")
            .attr("id", "audio-digit-" + number)
            .attr("preload", "none")
            .append(source);

          return audio;
      }

      var numbers = [];
      var number2audio = {};
      for (var digit = 1; digit <= 10; digit++) {
        numbers.push(digit);
      }

      function constructRandomButton() {
        var button = $("<button />")
          .attr("lang", "en")
          .addClass("block")
          .text("Play random number")
          .mousedown(function() {
            var number = numbers[Math.floor(Math.random() * numbers.length)];
            play(number);
            $("#answer").text("Current playing: " + number2text(number));
          });
          $("body").append(button);
      }

      function number2text(number) {
        return number + "日";
      }

      function getAnswerDiv() {
        return $("<div />")
          .attr("id", "answer")
          .attr("lang", "ja");
      }

      function main() {
        numbers.forEach(function (number) {
          var audio = getDayOfTheMonthAudio(number);
          $("body").append(audio);
          number2audio[number] = audio;
        })
        constructRandomButton();
        $("body").append(getAnswerDiv());
      }

      var dummyAudio = $("<audio />")[0];
      var prevAudio = dummyAudio;
      function play(number) {
        prevAudio.pause();
        prevAudio.currentTime = 0;

        var currAudio = number2audio[number][0];
        currAudio.play();
        prevAudio = currAudio;
      }
    </script>
</head>
<body>

<h1 lang="ja">聴忍者</h1>

</body>
</html>
